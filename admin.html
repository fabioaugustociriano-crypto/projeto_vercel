<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Painel do Dono - Saron Cortinas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#b30000 0%,#444 100%);margin:0;padding:20px;color:#333;}
    .container {max-width:800px;margin:20px auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 6px 15px rgba(0,0,0,.15);}
    h1 {text-align:center;color:#b30000;}
    input, select {width:100%;padding:12px;margin:8px 0;border:1px solid #ccc;border-radius:8px;font-size:15px;}
    button {padding:10px 15px;background:#b30000;border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
    button:hover {background:#800000;}
    table {width:100%;margin-top:20px;border-collapse:collapse;}
    table, th, td {border:1px solid #ddd;}
    th, td {padding:10px;text-align:center;}
    th {background:#f5f5f5;}
    img.thumb {max-width:80px;border-radius:5px;cursor:pointer;margin:3px;}
    a.pdf-link {color:#b30000;font-weight:600;text-decoration:none;display:block;margin:3px 0;}
    a.pdf-link:hover {text-decoration:underline;}
    .logo {display:block;margin:0 auto 15px auto;max-width:200px;}
    .modal {display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;}
    .modal img {max-width:90%;max-height:90%;border-radius:10px;}
    .logout {margin-top:20px;text-align:center;}
  </style>
</head>
<body>
  <div class="container">
    <img src="1.png" alt="Saron Cortinas" class="logo">
    <h1>Painel do Dono</h1>
    <input type="password" id="senha" placeholder="Digite a senha" onkeyup="checkSenha(event)">
    <div id="painel" style="display:none">
      <h2>Criar Pedido</h2>
      <input type="text" id="nome" placeholder="Nome do Cliente">
      <input type="text" id="cpf" maxlength="4" placeholder="√öltimos 4 d√≠gitos do CPF">
      <input type="text" id="desc" placeholder="Descri√ß√£o do Pedido">
      <input type="file" id="arquivos" multiple>
      <button onclick="adicionar()">Adicionar Pedido</button>
      <h2>Pedidos</h2>
      <table id="tabela">
        <tr>
          <th>Cliente</th>
          <th>CPF</th>
          <th>Descri√ß√£o</th>
          <th>Status</th>
          <th>Arquivos</th>
          <th>A√ß√µes</th>
        </tr>
      </table>
      <div class="logout">
        <button onclick="sair()">Sair do Admin</button>
      </div>
    </div>
  </div>
  <div id="modal" class="modal" onclick="this.style.display='none'">
    <img id="modal-img" src="">
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, push, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAv_JfhkboDI7Iqo1tcV7hP2R94W5U-UFw",
    authDomain: "saron-cortinas.firebaseapp.com",
    databaseURL: "https://saron-cortinas-default-rtdb.firebaseio.com",
    projectId: "saron-cortinas",
    storageBucket: "saron-cortinas.appspot.com",
    messagingSenderId: "1004919070090",
    appId: "1:1004919070090:web:6162c6accfe1d418cb7c73"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);
  const senhaCorreta = "Batista2025";

  async function checkSenha(e){
    if(e.key === "Enter" || e.type === "click"){
      const senha = document.getElementById("senha").value;
      if(senha === senhaCorreta){
        document.getElementById("senha").style.display="none";
        document.getElementById("painel").style.display="block";
        await set(ref(db, "adminMode"), true);
        listar();
      } else { alert("Senha incorreta!"); }
    }
  }

  async function adicionar(){
    const nome = document.getElementById("nome").value.trim();
    const cpf = document.getElementById("cpf").value.trim();
    const desc = document.getElementById("desc").value.trim();
    const arquivos = document.getElementById("arquivos").files;
    if(!nome || !cpf || !desc){ alert("Preencha todos os campos!"); return; }

    const pedidosRef = ref(db, "pedidos");
    const novoRef = push(pedidosRef);
    const pedidoId = novoRef.key;
    let pedido = {nome, cpf, desc, status:"Criado", fotos:[], pdfs:[]};
    await set(novoRef, pedido);

    for(let file of arquivos){
      const path = `pedidos/${pedidoId}/${file.name}`;
      const fileRef = sRef(storage, path);
      await uploadBytes(fileRef, file);
      const url = await getDownloadURL(fileRef);
      if(file.type.startsWith("image/")) pedido.fotos.push(url);
      if(file.type === "application/pdf") pedido.pdfs.push(url);
    }
    await update(novoRef, pedido);
    listar();
    alert("Pedido adicionado!");
  }

  async function listar(){
    const snapshot = await get(ref(db, "pedidos"));
    const tabela = document.getElementById("tabela");
    tabela.innerHTML = `<tr><th>Cliente</th><th>CPF</th><th>Descri√ß√£o</th><th>Status</th><th>Arquivos</th><th>A√ß√µes</th></tr>`;
    if(snapshot.exists()){
      const pedidos = snapshot.val();
      Object.entries(pedidos).forEach(([id,p])=>{
        let arquivosHTML = "";
        if(p.fotos){ p.fotos.forEach(url=>{ arquivosHTML += `<img src="${url}" class="thumb" onclick="abrirModal('${url}')">`; }); }
        if(p.pdfs){ p.pdfs.forEach(url=>{ arquivosHTML += `<a href="${url}" target="_blank" class="pdf-link">üìÑ PDF</a>`; }); }
        tabela.innerHTML += `
          <tr>
            <td>${p.nome}</td>
            <td>****${p.cpf}</td>
            <td>${p.desc}</td>
            <td><select onchange="atualizarStatus('${id}',this.value)">
              <option ${p.status==="Criado"?"selected":""}>Criado</option>
              <option ${p.status==="Em produ√ß√£o"?"selected":""}>Em produ√ß√£o</option>
              <option ${p.status==="Saiu para entrega"?"selected":""}>Saiu para entrega</option>
              <option ${p.status==="Saiu para instala√ß√£o"?"selected":""}>Saiu para instala√ß√£o</option>
              <option ${p.status==="Pedido pronto para retirada na loja"?"selected":""}>Pedido pronto para retirada na loja</option>
              <option ${p.status==="Instala√ß√£o concluida pedido finalizado"?"selected":""}>Instala√ß√£o concluida pedido finalizado</option>
            </select></td>
            <td>${arquivosHTML}</td>
            <td><button onclick="remover('${id}')">Excluir</button></td>
          </tr>`;
      });
    }
  }

  async function atualizarStatus(id,status){ await update(ref(db,"pedidos/"+id),{status}); listar(); }
  async function remover(id){ await remove(ref(db,"pedidos/"+id)); listar(); }
  async function sair(){ await set(ref(db,"adminMode"),false); alert("Voc√™ saiu do Admin!"); location.reload(); }
  window.checkSenha=checkSenha;window.adicionar=adicionar;window.atualizarStatus=atualizarStatus;window.remover=remover;window.sair=sair;
  window.abrirModal=(src)=>{document.getElementById("modal-img").src=src;document.getElementById("modal").style.display="flex";};
</script>
</body>
</html>